<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insight Vault v2.4</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #0f1a2e;
      --text: #e9eefc;
      --muted: #a9b4d0;
      --accent: #7c5cff;
      --accent2: #00d4b4;
      --border: rgba(255,255,255,.08);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, #1a2a52 0%, var(--bg) 60%);
      color: var(--text);
      min-height: 100vh;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 28px 22px 60px; }
    header { margin-bottom: 28px; }
    header h1 { font-size: 36px; letter-spacing: -0.5px; margin-bottom: 4px; }
    header h1 span { color: var(--accent); }
    header p { color: var(--muted); font-size: 14px; }

```
.status-bar {
  background: rgba(15,26,46,.5);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px 16px;
  margin-bottom: 20px;
  font-size: 12px;
  color: var(--muted);
  display: flex;
  align-items: center;
  gap: 8px;
}
.status-dot { width: 8px; height: 8px; border-radius: 50%; }
.dot-ok { background: #00d4b4; }
.dot-err { background: #ff6b6b; }
.dot-loading { background: #f7c948; }

.tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 24px;
  border-bottom: 1px solid var(--border);
}
.tab {
  padding: 10px 20px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  color: var(--muted);
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  transition: all 0.2s;
  border-radius: 8px 8px 0 0;
}
.tab:hover { color: var(--text); }
.tab.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
}

.panel { display: none; }
.panel.active { display: block; }

.btn {
  cursor: pointer;
  border: 1px solid var(--border);
  color: var(--text);
  padding: 11px 20px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 600;
  background: linear-gradient(180deg, rgba(124,92,255,.28), rgba(124,92,255,.12));
  transition: all 0.2s;
  white-space: nowrap;
}
.btn:hover {
  border-color: rgba(124,92,255,.5);
  background: rgba(124,92,255,.22);
}
.btn.primary {
  background: linear-gradient(135deg, var(--accent), #5b3fd4);
  border-color: var(--accent);
}
.btn.success {
  background: linear-gradient(135deg, #00a884, #007a60);
  border-color: var(--accent2);
}
.btn:disabled { opacity: 0.4; cursor: not-allowed; }

.pillars-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 16px;
}
.pillar-card {
  background: rgba(15,26,46,.55);
  border: 1px solid var(--border);
  border-radius: 14px;
  overflow: hidden;
}
.pillar-head {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}
.pillar-head h4 {
  font-size: 14px;
  font-weight: 700;
  flex: 1;
}
.pillar-num {
  font-size: 11px;
  font-weight: 700;
  background: rgba(124,92,255,.15);
  color: #b4a0ff;
  padding: 3px 10px;
  border-radius: 20px;
}
.pillar-topics {
  padding: 16px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  max-height: 300px;
  overflow-y: auto;
}
.topic-tag {
  font-size: 11px;
  padding: 4px 10px;
  border-radius: 20px;
  background: rgba(0,212,180,.08);
  border: 1px solid rgba(0,212,180,.15);
  color: #6ee7d4;
  white-space: nowrap;
}

.vault-grid { display: flex; flex-direction: column; gap: 12px; }
.vault-item {
  background: rgba(15,26,46,.55);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 16px;
  cursor: pointer;
  transition: border-color 0.2s;
}
.vault-item:hover { border-color: rgba(124,92,255,.4); }
.vault-item-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 8px;
}
.vault-item h4 { font-size: 14px; font-weight: 700; }
.vault-pill {
  font-size: 11px;
  padding: 3px 9px;
  border-radius: 20px;
  background: rgba(124,92,255,.12);
  border: 1px solid rgba(124,92,255,.2);
  color: #b4a0ff;
}
.status-dot-item {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 5px;
}
.dot-classified { background: #00d4b4; }
.dot-confirmed { background: #6c63ff; }
.edit-icon {
  font-size: 16px;
  padding: 6px;
  border-radius: 6px;
  background: rgba(124,92,255,.15);
  cursor: pointer;
  transition: all 0.2s;
}
.edit-icon:hover { background: rgba(124,92,255,.25); }

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}
.modal-overlay.visible { display: flex; }
.modal {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 20px;
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  padding: 28px;
}
.modal h2 { font-size: 20px; margin-bottom: 20px; }
.form-group { margin-bottom: 20px; }
.form-group label {
  display: block;
  font-size: 12px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}
.form-group select {
  width: 100%;
  background: rgba(15,26,46,.65);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 14px;
  outline: none;
}
.form-group select:focus { border-color: var(--accent); }
.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 24px;
}

.filter-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}
.filter-bar select, .filter-bar input {
  background: rgba(15,26,46,.65);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 10px 14px;
  border-radius: 10px;
  font-size: 13px;
  outline: none;
}
.filter-bar input { flex: 1; min-width: 200px; }

.empty-state {
  text-align: center;
  padding: 48px;
  color: var(--muted);
}
.empty-state .big { font-size: 40px; margin-bottom: 12px; }

#toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: #1e2038;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 18px;
  font-size: 13px;
  transform: translateY(80px);
  opacity: 0;
  transition: all 0.3s;
  z-index: 999;
}
#toast.show {
  transform: translateY(0);
  opacity: 1;
}
```

  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üìò Insight <span>Vault</span></h1>
    <p>AI-native personal knowledge system ‚Äî upload, classify, organize.</p>
  </header>

  <div id="statusBar" class="status-bar">
    <div class="status-dot dot-loading"></div>
    <span id="statusText">Connecting to backend‚Ä¶</span>
  </div>

  <div class="tabs">
    <button class="tab" onclick="switchTab('upload',this)">‚¨ÜÔ∏è Upload</button>
    <button class="tab" onclick="switchTab('youtube',this)">‚ñ∂Ô∏è YouTube</button>
    <button class="tab" onclick="switchTab('vault',this)">üóÑ Vault</button>
    <button class="tab active" onclick="switchTab('taxonomy',this)">üóÇ Taxonomy</button>
  </div>

  <div class="panel" id="tab-upload">
    <p style="color:var(--muted);padding:20px;text-align:center;">Upload tab - Em desenvolvimento</p>
  </div>

  <div class="panel" id="tab-youtube">
    <p style="color:var(--muted);padding:20px;text-align:center;">YouTube tab - Em desenvolvimento</p>
  </div>

  <div class="panel" id="tab-vault">
    <div class="filter-bar">
      <input type="text" id="vaultSearch" placeholder="Buscar no vault..." oninput="loadVault()">
      <select id="vaultPillar" onchange="loadVault()">
        <option value="">Todos os Pilares</option>
      </select>
      <button class="btn" onclick="loadVault()">üîÑ Refresh</button>
    </div>
    <div class="vault-grid" id="vaultGrid">
      <div class="empty-state">
        <div class="big">üóÑ</div>
        <p>Carregando vault...</p>
      </div>
    </div>
  </div>

  <div class="panel active" id="tab-taxonomy">
    <div class="pillars-grid" id="taxonomyGrid">
      <div class="empty-state">
        <div class="big">üóÇ</div>
        <p>Carregando taxonomia...</p>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="editModal">
  <div class="modal">
    <h2>‚úèÔ∏è Reclassificar Item</h2>
    <div style="margin-bottom:20px;padding:12px;background:rgba(11,22,40,.5);border-radius:10px;font-size:13px;">
      <strong id="editItemName"></strong>
    </div>
    <div class="form-group">
      <label>Pilar</label>
      <select id="editPillar" onchange="updateTopicsDropdown()">
        <option value="">Selecione um pilar...</option>
      </select>
    </div>
    <div class="form-group">
      <label>T√≥pico</label>
      <select id="editTopic">
        <option value="">Primeiro selecione um pilar</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn" onclick="closeEditModal()">Cancelar</button>
      <button class="btn success" onclick="saveReclassify()">üíæ Salvar</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
const API = "https://insight-vault-58jj.onrender.com";
let PILLARS = [];
let currentEditItem = null;

const FULL_TAXONOMY = [
  {
    id: "P1",
    name_pt: "Desenvolvimento Pessoal & Efic√°cia",
    name_en: "Personal Development & Effectiveness",
    topics: ["Desenvolvimento","Desenvolvimento pessoal","Melhoria cont√≠nua","Lifelong learning","Aprendizagem","Conhecimento","Proatividade","Efic√°cia","Efici√™ncia","Gest√£o de tempo","Time management","Disciplina","H√°bitos","Excel√™ncia","Organiza√ß√£o","Foco","Deep work","Resili√™ncia","Grit","Persist√™ncia","Perseveran√ßa","Consist√™ncia","Mentalidade de crescimento","Growth Mindset","Crescimento","Performance","Pensamento cr√≠tico","M√©todo cient√≠fico"]
  },
  {
    id: "P2",
    name_pt: "Sa√∫de, Bem-estar e Espiritualidade",
    name_en: "Health, Wellbeing & Spirituality",
    topics: ["Equil√≠brio","Sa√∫de f√≠sica","Gin√°stica e treinos","Nutri√ß√£o & suplementa√ß√£o","Sono","Sa√∫de mental","Terapia","Intelig√™ncia Emocional","Autoconhecimento","Lazer","Hobbies","Bem-estar","Espiritualidade & religi√£o","Gest√£o de estresse","Energia","Vitalidade","Longevidade","Conex√£o","Medita√ß√£o","Paz interior","Escuta do cora√ß√£o","Transcend√™ncia","Consci√™ncia","Prop√≥sito","Sentido","Felicidade","Happiness","Gratid√£o","Humanidade","Otimismo","Vulnerabilidade","Sabedoria","Realiza√ß√£o"]
  },
  {
    id: "P3",
    name_pt: "Atitude e Imagem",
    name_en: "Attitude & Image",
    topics: ["Atitude","Postura","Postura profissional","Imagem","Imagem p√∫blica","M√≠dias sociais","Reputa√ß√£o","Vestu√°rio","Marca pessoal","Identidade","Autenticidade","Inova√ß√£o","Flexibilidade","Criatividade"]
  },
  {
    id: "P4",
    name_pt: "Relacionamentos, Comunica√ß√£o e Vendas",
    name_en: "Relationships, Communication & Sales",
    topics: ["Relacionamentos","Amizades","Comunidades","Networking","Comunica√ß√£o","Comunica√ß√£o n√£o violenta","Escuta","Escuta ativa","Empatia","Rapport","Orat√≥ria","Influ√™ncia","Persuas√£o","Negocia√ß√£o","Resolu√ß√£o de conflitos","Vendas","Storytelling"]
  },
  {
    id: "P5",
    name_pt: "Lideran√ßa, Estrat√©gia & Cultura",
    name_en: "Leadership, Strategy & Culture",
    topics: ["Lideran√ßa","Gest√£o de pessoas","Gest√£o de projetos","Scrum","Trabalho em equipe","Delega√ß√£o","Cultura","Cultura de Excel√™ncia","Miss√£o, Vis√£o e Valores Organizacionais","Estrat√©gia","Estrat√©gia empresarial","Governan√ßa","Sistemas organizacionais","Decis√£o","Decision making"]
  },
  {
    id: "P6",
    name_pt: "Business, Money & Wealth",
    name_en: "Business, Money & Wealth",
    topics: ["Finan√ßas","Dinheiro","Patrim√¥nio","Ativos","Gest√£o financeira","Aloca√ß√£o de capital","Investimentos","Avalia√ß√£o de risco","Empreendedorismo"]
  },
  {
    id: "P7",
    name_pt: "Valores, Car√°ter e Integridade",
    name_en: "Values, Character & Integrity",
    topics: ["√âtica","Justi√ßa","Moral","Responsabilidade","Seriedade","Compromisso","Honra","Integridade","Coragem","Coragem Moral","Car√°ter","Virtude","Compaix√£o","Humildade","Liberdade","Princ√≠pios","Valores","Servi√ßo"]
  },
  {
    id: "P8",
    name_pt: "Fam√≠lia & Legado",
    name_en: "Family & Legacy",
    topics: ["Fam√≠lia","Legado","Nome","Reputa√ß√£o","Paternidade","Presen√ßa emocional","Tradi√ß√µes familiares","Modelo de vida","Educa√ß√£o moral","Experi√™ncias","Cartas e orienta√ß√µes"]
  }
];

function switchTab(id, btn) {
  document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.getElementById("tab-" + id).classList.add("active");
  btn.classList.add("active");
  if (id === "vault") loadVault();
  if (id === "taxonomy") renderTaxonomy();
}

function toast(msg, duration = 3000) {
  const el = document.getElementById("toast");
  el.textContent = msg;
  el.classList.add("show");
  setTimeout(() => el.classList.remove("show"), duration);
}

function setStatus(msg, type = "ok") {
  const bar = document.getElementById("statusBar");
  const dot = bar.querySelector(".status-dot");
  const txt = document.getElementById("statusText");
  dot.className = "status-dot";
  dot.classList.add(type === "ok" ? "dot-ok" : type === "err" ? "dot-err" : "dot-loading");
  txt.textContent = msg;
}

async function checkHealth() {
  try {
    const r = await fetch(`${API}/health`);
    const d = await r.json();
    setStatus(`Backend online ¬∑ ${d.items} items ¬∑ v${d.version}`, "ok");
  } catch (e) {
    setStatus("Backend offline", "err");
  }
}

async function loadPillars() {
  try {
    const r = await fetch(`${API}/pillars`);
    PILLARS = await r.json();
    populatePillarDropdowns();
  } catch (e) {
    console.error("Failed to load pillars:", e);
    PILLARS = FULL_TAXONOMY;
    populatePillarDropdowns();
  }
}

function populatePillarDropdowns() {
  const select = document.getElementById("editPillar");
  const vaultSelect = document.getElementById("vaultPillar");
  
  select.innerHTML = '<option value="">Selecione um pilar...</option>';
  vaultSelect.innerHTML = '<option value="">Todos os Pilares</option>';
  
  PILLARS.forEach(p => {
    const opt1 = document.createElement("option");
    opt1.value = p.id;
    opt1.textContent = `${p.id} ‚Äì ${p.name_pt}`;
    select.appendChild(opt1);
    
    const opt2 = document.createElement("option");
    opt2.value = p.id;
    opt2.textContent = `${p.id} ‚Äì ${p.name_pt}`;
    vaultSelect.appendChild(opt2);
  });
}

function updateTopicsDropdown() {
  const pillarId = document.getElementById("editPillar").value;
  const topicSelect = document.getElementById("editTopic");
  topicSelect.innerHTML = '<option value="">Selecione um t√≥pico...</option>';
  
  if (!pillarId) return;
  
  const pillar = PILLARS.find(p => p.id === pillarId);
  if (!pillar) return;
  
  pillar.topics.forEach(topic => {
    const opt = document.createElement("option");
    opt.value = topic;
    opt.textContent = topic;
    topicSelect.appendChild(opt);
  });
}

function openEditModal(item) {
  currentEditItem = item;
  document.getElementById("editItemName").textContent = item.original || item.filename;
  document.getElementById("editPillar").value = item.pillar_id || "";
  updateTopicsDropdown();
  document.getElementById("editTopic").value = item.topic_name || "";
  document.getElementById("editModal").classList.add("visible");
}

function closeEditModal() {
  document.getElementById("editModal").classList.remove("visible");
  currentEditItem = null;
}

async function saveReclassify() {
  const pillar_id = document.getElementById("editPillar").value;
  const topic_name = document.getElementById("editTopic").value;
  
  if (!pillar_id || !topic_name) {
    return toast("Selecione pilar e t√≥pico");
  }
  
  try {
    const res = await fetch(`${API}/items/${currentEditItem.id}/reclassify`, {
      method: "PATCH",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ pillar_id, topic_name })
    });
    const data = await res.json();
    if (data.success) {
      toast("Item reclassificado com sucesso! ‚úÖ");
      closeEditModal();
      loadVault();
    } else {
      toast("Erro ao reclassificar: " + (data.error || "desconhecido"));
    }
  } catch (e) {
    toast("Erro: " + e.message);
  }
}

async function loadVault() {
  const search = document.getElementById("vaultSearch").value.toLowerCase();
  const pillar = document.getElementById("vaultPillar").value;
  let url = `${API}/vault?limit=100`;
  if (pillar) url += `&pillar=${pillar}`;
  
  try {
    const res = await fetch(url);
    const data = await res.json();
    let items = data.items || [];
    
    if (search) {
      items = items.filter(i =>
        (i.original||"").toLowerCase().includes(search) ||
        (i.summary||"").toLowerCase().includes(search) ||
        (i.pillar_name||"").toLowerCase().includes(search) ||
        (i.topic_name||"").toLowerCase().includes(search)
      );
    }
    
    const grid = document.getElementById("vaultGrid");
    
    if (!items.length) {
      grid.innerHTML = `<div class="empty-state"><div class="big">üóÑ</div><p>Nenhum item encontrado. Fa√ßa upload de conte√∫do!</p></div>`;
      return;
    }
    
    grid.innerHTML = items.map(item => `
      <div class="vault-item" onclick='openEditModal(${JSON.stringify(item).replace(/'/g, "\\'")}); event.stopPropagation();'>
        <div class="vault-item-header">
          <div style="display:flex;align-items:flex-start;gap:8px;flex:1;">
            <div class="status-dot-item dot-${item.status}"></div>
            <div>
              <h4>${item.original || item.filename}</h4>
              <div style="margin-top:6px;display:flex;gap:6px;flex-wrap:wrap;">
                <span class="vault-pill">${item.pillar_id||"?"} ‚Äì ${item.pillar_name||"Sem classifica√ß√£o"}</span>
                ${item.topic_name ? `<span class="vault-pill" style="background:rgba(0,212,180,.1);border-color:rgba(0,212,180,.2);color:#6ee7d4;">${item.topic_name}</span>` : ""}
              </div>
            </div>
          </div>
          <span class="edit-icon" title="Editar classifica√ß√£o">‚úèÔ∏è</span>
        </div>
        <div style="font-size:12px;color:var(--muted);margin-top:8px;">${item.summary || "Sem resumo dispon√≠vel."}</div>
      </div>
    `).join("");
    
  } catch (e) {
    document.getElementById("vaultGrid").innerHTML =
      `<div class="empty-state"><p style="color:#ff6b6b;">Erro ao carregar: ${e.message}</p></div>`;
  }
}

function renderTaxonomy() {
  const grid = document.getElementById("taxonomyGrid");
  
  if (!PILLARS.length) {
    grid.innerHTML = `<div class="empty-state"><div class="big">‚è≥</div><p>Carregando taxonomia...</p></div>`;
    return;
  }
  
  grid.innerHTML = PILLARS.map(p => `
    <div class="pillar-card">
      <div class="pillar-head">
        <h4>${p.name_pt}<br><small style="font-size:11px;color:var(--muted);font-weight:400;">${p.name_en}</small></h4>
        <span class="pillar-num">${p.id}</span>
      </div>
      <div class="pillar-topics">
        ${p.topics.map(t => `<span class="topic-tag">${t}</span>`).join("")}
      </div>
    </div>
  `).join("");
}

checkHealth();
loadPillars().then(() => {
  renderTaxonomy();
});
</script>

</body>
</html>
